image: multiarch/debian-debootstrap

arches:
  - arm64

targets:
  - jessie

env:
  - REPO=lunhg/alpine
  - BRANCH=aarch64
  - GITHUB=https://www.github.com
  - DOCKER_DOWNLOAD=https://releases.rancher.com/install-docker
  - DOCKER_VERSION=18.06
  - DOCKER_COMPOSE_DOWNLOAD= https://github.com/docker/compose/releases/download
  - DOCKER_COMPOSE_VERSION=1.23.1


before_install:
  - echo "`whoami` at `uname -a`" \
    && apt-get update \
    && apt-get install -y git curl make python

install:
  - echo "`whoami` at `uname -a`" \
    && curl $DOCKER_DOWNLOAD/$DOCKER_VERSION.sh | sh >> $HOME/bin/docker \
    && curl -L $DOCKER_COMPOSE_DOWNLOAD/$DOCKER_COMPOSE_VERSION/run.sh | sh >> $HOME/bin/docker-compose
    
after_install:
  - for i in "docker" "docker-compose" ; \
      chmod +x $HOME/bin/$$i ; \
    done \
    && export PATH=$PATH:$HOME/bin

before_script:
  - echo $REPO | sed -E 's|(.+)/(.+)|$HOME/\1|g' | mkdir \
    && git clone --branch=$BRANCH $GITHUB/$REPO $HOME/$REPO \
    && docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD

script:
  - for "up" "ps" "logs" "push" ; do \
      docker-compose up \
        -d \
        --project-directory $HOME/alpine ; \
    done
